{% extends "layout.jinja2" %}

{#
<!-- {% block pagestyles %}
  {% assets "home_less_bundle" %}
    <link href="{{ ASSET_URL }}" rel="stylesheet" type="text/css">
  {% endassets %}
{% endblock %} -->
#}

{% block content %}
  {% include "navigation.jinja2" %}

    <div class="row">
      <h1>{{ title }}</h1>
    </div>
    <div class="row">

      <div class="card border-secondary mb-3" style="max-width: 50%;" >
        <div class="card-header">Total Bounties Ever </div>
        <div class="card-body">
          <h4 class="card-title">{{ "{:,.2f}".format(df_bounty_formatted['bounty_value'].sum()) }}</h4>

          {# <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p> #}
        </div>
      </div>
      <div class="card border-primary mb-3" style="max-width: 50%;" >
        <div class="card-header">Total_Bounties Current Round :  </div>
        <div class="card-body">
          <h4 class="card-title">{{ "{:,.2f}".format(df_current['bounty_value'].sum()) }}</h4>

          {# <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p> #}
        </div>
      </div>



    </div>
    <div class="row">
      <div class="card text-white bg-secondary mb-10"  style="max-width: 50%;">
        <div class="card-header">Prior Round Vote ;Distribution</div>
        <div class="card-body">
            <h4 class="card-title"></h4>
            {# <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p> #}
            <div id="chart4" class="chart4"></div>

        </div>              
    </div>
    <div class="card text-white bg-primary mb-10"  style="max-width: 50%;">
      <div class="card-header">Current Round Vote Distribution</div>
      <div class="card-body">
          {# <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p> #}
          <div id="chart3" class="chart3"></div>

      </div>              
    </div>
  </div>
  <div class="row">
    <div class="card text-white bg-secondary mb-10"  style="max-width: 50%;">
      <div class="card-header">Prior Bounty Explorer</div>
      <div class="card-body">
          {# <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p> #}
          <div id="chart6" class="chart6"></div>

      </div>              
    </div>

    <div class="card text-white bg-primary mb-10"  style="max-width: 50%;">
      <div class="card-header">Current Bounty Explorer</div>
      <div class="card-body">
          {# <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p> #}
          <div id="chart5" class="chart5"></div>

      </div>              
    </div>

  </div>

  <div class="row">
    <div class="card text-white bg-success mb-10" >
      <div class="card-header">Bounty Explorer By Gauge</div>
      <div class="card-body">
          {# <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p> #}
          <div id="chart7" class="chart7"></div>

      </div>              
    </div>


  </div>

  <div class="row">
    <div class="card text-white bg-danger mb-10" >
      <div class="card-header">Bounty Explorer by Bounty Token</div>
      <div class="card-body">
          {# <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p> #}
          <div id="chart8" class="chart8"></div>

      </div>              
    </div>


  </div>

  <div class="row">
    <div class="card text-white bg-info mb-10"  style="max-width: 50%;">
      <div class="card-header">Vote Power Per Round</div>
      <div class="card-body">
          {# <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p> #}
          <div id="chart" class="chart"></div>

      </div>              
    </div>

    <div class="card text-white bg-warning mb-10"  style="max-width: 50%;">
      <div class="card-header">Votes Per Dollar Bounties</div>
      <div class="card-body">
          {# <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p> #}
          <div id="chart2" class="chart2"></div>

      </div>              
    </div>
  </div>
  <div class="row">

    <div id="bounty_table"></div>

  </div>


<script type='text/javascript'>
      new gridjs.Grid({
        columns: [
          { id: 'period_end_date', name: 'Round End Date' },
          { id: 'gauge_ref', name: 'Gauge Ref' },
          { id: 'token_symbol', name: 'Token Symbol' },

          { id: 'token_amount', name: 'Token Amount' ,
            formatter: (_, row) =>  `${row.cells[3].data.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`
          },

          { id: 'bounty_value', name: 'Bounty USD Value',
            formatter: (_, row) =>  `${row.cells[4].data.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`
          },


          { id: 'price_per_vote', name: 'Price Per Vote',
          },

          { id: 'votes_per_dollar', name: 'Vote Per Dollar',
            formatter: (_, row) =>  `${row.cells[6].data.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`
          },

          { id: 'relative_vote_power', name: 'Relative Vote Power',
            formatter: (_, row) =>  `${row.cells[7].data.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`
          },

          { id: 'total_vote_power', name: 'Total Vote Power',
            formatter: (_, row) =>  `${row.cells[8].data.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`
          },

          { id: 'voter_count', name: 'Voter Count',
            formatter: (_, row) =>  `${row.cells[9].data.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`
          },

          { id: 'actions', 
            name: 'Actions',
            formatter: (_, row) => gridjs.html(`<a href='show/${row.cells[1].data}'>More</a>`)
          },
          { id: 'period', name: 'Round' },
          { id: 'gauge_addr', name: 'Gauge Addr' },


        ],
        data: [
          {% for index, row in df_bounty_formatted.iterrows() %}
            {
              'period_end_date': '{{ row['period_end_date'] }}',
              'gauge_ref': '{{ row['gauge_ref'] }}',
              'token_symbol': '{{ row['token_symbol'] }}',
              'token_amount': '{{ row['amount'] }}',

              'bounty_value': '{{ row['bounty_value']|round(2) }}',


              'price_per_vote': '{{ row['price_per_vote']| round(6) }}',
              'votes_per_dollar': '{{ row['votes_per_dollar'] | round(2)}}',
              
              'relative_vote_power': '{{ row['relative_vote_power'] | round(2) }}',

              'total_vote_power': '{{ row['total_vote_power'] | round(2) }}',

              'voter_count': '{{ row['total_vote_count'] }}',
              'actions': null,
              'period': '{{ row['period'] }}',
              'gauge_addr': '{{ row['gauge_addr'] }}',


            },
          {% endfor %}
        ],
        fixedHeader: true,
        search: true,
        sort: true,
        pagination: {
          limit: 50,
          summary: true
        },
        className: {
          {# td: 'my-td-class', #}
          th: 'table-primary',
          table: 'table table-hover' 
        }
      }).render(document.getElementById('bounty_table'));
</script>


<script src='https://cdn.plot.ly/plotly-latest.min.js'></script>

<script type='text/javascript'>
  var graphs = {{graphJSON | safe}};
  Plotly.plot('chart',graphs,{});
</script>

<script type='text/javascript'>
  var graphs2 = {{graphJSON2 | safe}};
  Plotly.plot('chart2',graphs2,{});
</script>

<script type='text/javascript'>
  var graphs3 = {{graphJSON3 | safe}};
  Plotly.plot('chart3',graphs3,{});
</script>

<script type='text/javascript'>
  var graphs4 = {{graphJSON4 | safe}};
  Plotly.plot('chart4',graphs4,{});
</script>

<script type='text/javascript'>
  var graphs5 = {{graphJSON5 | safe}};
  Plotly.plot('chart5',graphs5,{});
</script>

<script type='text/javascript'>
  var graphs6 = {{graphJSON6 | safe}};
  Plotly.plot('chart6',graphs6,{});
</script>

<script type='text/javascript'>
  var graphs7 = {{graphJSON7 | safe}};
  Plotly.plot('chart7',graphs7,{});
</script>

<script type='text/javascript'>
  var graphs8 = {{graphJSON8 | safe}};
  Plotly.plot('chart8',graphs8,{});
</script>
{% endblock %}
